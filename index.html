<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Scanner</title>
    <link rel="stylesheet" href="style.css">

    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; text-align: center; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px; }
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      #show { white-space: pre-wrap; font-size: 14px; text-align: left; } /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
  <body>

    <div id="message">
      <h2 id="head">LIFF QR Scanner</h2>
      <div id="show">Loading LIFF...</div> 
      <div style="margin-top:18px;">
        <button id="scanBtn" disabled style="background:#039be5;color:#fff;border:none;padding:12px 18px;border-radius:6px;font-size:16px;cursor:pointer;">Scan QR Code</button>
      </div>
    </div>

    <script>
      const LIFF_ID = '2008561421-rBaENVkA';
      const showElement = document.getElementById('show');
      const scanBtn = document.getElementById('scanBtn');
      let currentUID = '';

      // --- 1. INITIALIZE LIFF ---
      liff.init({ liffId: LIFF_ID })
        .then(() => {
          showLiffStatus();
        })
        .catch(err => {
          showElement.textContent = 'LIFF init error: ' + err;
          console.error('liff.init error', err);
        });

      // --- 2. SETUP BUTTON HANDLER ---
      scanBtn.addEventListener('click', startScan);
      
      // --- 3. SHOW LIFF STATUS AND UID ---
      async function showLiffStatus() {
        if (!liff.isLoggedIn()) {
          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° Login
          scanBtn.disabled = true;
          scanBtn.textContent = 'Login Required';
          // ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏ä‡πâ liff.login() ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ
          showElement.textContent = 'Please login to LINE to use this function.';
          return;
        }

        try {
          // ‡∏î‡∏∂‡∏á UID ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
          const profile = await liff.getProfile();
          currentUID = profile.userId;

          let info = "‚úÖ LIFF Ready\n";
          info += `üë§ Your UID: ${currentUID}\n`;
          info += `Platform: ${liff.getOS()} / LINE v${liff.getLineVersion()}`;
          showElement.textContent = info;
          
          scanBtn.disabled = false;
        } catch (err) {
          showElement.textContent = 'Failed to get profile: ' + err;
          scanBtn.disabled = true;
        }
      }

      // --- 4. START QR SCANNING FLOW ---
      async function startScan() {
        if (!liff.isInClient()) {
          showElement.textContent = '‚ùå Must be opened inside the LINE app.';
          return;
        }

        if (!liff.scanCode) {
          showElement.textContent = '‚ùå scanCode API not available (Check LIFF Scope).';
          return;
        }
        
        scanBtn.disabled = true;
        scanBtn.textContent = 'Scanning...';

        try {
          const result = await liff.scanCode();
          const qrValue = result.value || 'No QR Code scanned.';

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ UID ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤ QR ‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ
          let info = "‚úÖ LIFF Ready\n";
          info += `üë§ Your UID: ${currentUID}\n`;
          info += `üîé QR Value: ${qrValue}`;
          showElement.textContent = info;

          scanBtn.disabled = false;
          scanBtn.textContent = 'Scan QR Code';
          
        } catch (err) {
          // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö Error ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
          showElement.textContent = `Scan failed: ${err.message || err}`;
          scanBtn.disabled = false;
          scanBtn.textContent = 'Scan QR Code (Error)';
        }
      }

    </script>

  </body>
</html>